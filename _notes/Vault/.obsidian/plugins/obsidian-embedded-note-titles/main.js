/*
THIS IS A GENERATED/BUNDLED FILE BY ROLLUP
if you want to view the source visit the plugins github repository
*/

'use strict';

var obsidian = require('obsidian');

const ELEMENT_RE = /[\w-]+/g;
const ID_RE = /#[\w-]+/g;
const CLASS_RE = /\.[\w-]+/g;
const ATTR_RE = /\[[^\]]+\]/g;
const PSEUDO_CLASSES_RE = /\:(?!not)[\w-]+(\(.*\))?/g;
const PSEUDO_ELEMENTS_RE = /\:\:?(after|before|first-letter|first-line|selection)/g;
// convert an array-like object to array
function toArray(list) {
    return [].slice.call(list);
}
// handles extraction of `cssRules` as an `Array` from a stylesheet or something that behaves the same
function getSheetRules(stylesheet) {
    var sheet_media = stylesheet.media && stylesheet.media.mediaText;
    // if this sheet is disabled skip it
    if (stylesheet.disabled)
        return [];
    // if this sheet's media is specified and doesn't match the viewport then skip it
    if (sheet_media &&
        sheet_media.length &&
        !window.matchMedia(sheet_media).matches)
        return [];
    // get the style rules of this sheet
    return toArray(stylesheet.cssRules);
}
function _find(string, re) {
    var matches = string.match(re);
    return matches ? matches.length : 0;
}
// calculates the specificity of a given `selector`
function calculateScore(selector) {
    var score = [0, 0, 0], parts = selector.split(" "), part, match;
    //TODO: clean the ':not' part since the last ELEMENT_RE will pick it up
    while (((part = parts.shift()), typeof part == "string")) {
        // find all pseudo-elements
        match = _find(part, PSEUDO_ELEMENTS_RE);
        score[2] += match;
        // and remove them
        match && (part = part.replace(PSEUDO_ELEMENTS_RE, ""));
        // find all pseudo-classes
        match = _find(part, PSEUDO_CLASSES_RE);
        score[1] += match;
        // and remove them
        match && (part = part.replace(PSEUDO_CLASSES_RE, ""));
        // find all attributes
        match = _find(part, ATTR_RE);
        score[1] += match;
        // and remove them
        match && (part = part.replace(ATTR_RE, ""));
        // find all IDs
        match = _find(part, ID_RE);
        score[0] += match;
        // and remove them
        match && (part = part.replace(ID_RE, ""));
        // find all classes
        match = _find(part, CLASS_RE);
        score[1] += match;
        // and remove them
        match && (part = part.replace(CLASS_RE, ""));
        // find all elements
        score[2] += _find(part, ELEMENT_RE);
    }
    return parseInt(score.join(""), 10);
}
// returns the heights possible specificity score an element can get from a give rule's selectorText
function getSpecificityScore(element, selectorText) {
    var selectors = selectorText.split(","), selector, score, result = 0;
    while ((selector = selectors.shift())) {
        if (element.matches(selector)) {
            score = calculateScore(selector);
            result = score > result ? score : result;
        }
    }
    return result;
}
function sortBySpecificity(element, rules) {
    // comparing function that sorts CSSStyleRules according to specificity of their `selectorText`
    function compareSpecificity(a, b) {
        let aScore = getSpecificityScore(element, a.selectorText);
        let bScore = getSpecificityScore(element, b.selectorText);
        // If the styles come from app.css, they take a lower priority
        if (aScore === bScore) {
            if (a.parentStyleSheet.href)
                aScore -= 1;
            if (b.parentStyleSheet.href)
                bScore -= 1;
        }
        return (aScore -
            bScore);
    }
    return rules.sort(compareSpecificity);
}
function getMatchedCSSRules(element) {
    let styleSheets = toArray(window.document.styleSheets);
    let sheet;
    let rules;
    let rule;
    let result = [];
    // assuming the browser hands us stylesheets in order of appearance
    // we iterate them from the beginning to follow proper cascade order
    while ((sheet = styleSheets.shift())) {
        // get the style rules of this sheet
        rules = getSheetRules(sheet);
        // loop the rules in order of appearance
        while ((rule = rules.shift())) {
            // if this is an @import rule
            if (rule.styleSheet) {
                // insert the imported stylesheet's rules at the beginning of this stylesheet's rules
                rules = getSheetRules(rule.styleSheet).concat(rules);
                // and skip this rule
                continue;
            }
            // if there's no stylesheet attribute BUT there IS a media attribute it's a media rule
            else if (rule.media) {
                // insert the contained rules of this media rule to the beginning of this stylesheet's rules
                rules = getSheetRules(rule).concat(rules);
                // and skip it
                continue;
            }
            // check if this element matches this rule's selector
            if (element.matches(rule.selectorText)) {
                // push the rule to the results set
                result.push(rule);
            }
        }
    }
    // sort according to specificity
    return sortBySpecificity(element, result);
}

// Split CSS margin and padding values like `0 auto`, `10px auto 0`, etc.
function getRightLeft(val) {
    if (/\s/.test(val)) {
        const vals = val.split(/\s+/g);
        if (vals.length === 2 || vals.length === 3) {
            return [vals[1], vals[1]];
        }
        if (vals.length === 4) {
            return [vals[1], vals[3]];
        }
    }
    return [val, val];
}
const keyMap = {
    width: "width",
    maxWidth: "max-width",
    margin: "margin",
    marginLeft: "margin-left",
    marginRight: "margin-right",
    padding: "padding",
    paddingLeft: "padding-left",
    paddingRight: "padding-right",
};
// Get the relevant style values from a reference element
function getRefSizing(el) {
    const rules = getMatchedCSSRules(el);
    const sizing = {};
    rules.forEach((r) => {
        const { width, maxWidth, margin, marginLeft, marginRight, padding, paddingLeft, paddingRight, } = r.style;
        if (width) {
            sizing.width = width;
        }
        if (maxWidth) {
            sizing.maxWidth = maxWidth;
        }
        if (margin) {
            const [mRight, mLeft] = getRightLeft(margin);
            sizing.marginLeft = mLeft;
            sizing.marginLeft = mRight;
        }
        if (marginLeft)
            sizing.marginLeft = marginLeft;
        if (marginRight)
            sizing.marginRight = marginRight;
        if (padding) {
            const [pRight, pLeft] = getRightLeft(padding);
            sizing.paddingLeft = pLeft;
            sizing.paddingLeft = pRight;
        }
        if (paddingLeft)
            sizing.paddingLeft = paddingLeft;
        if (paddingRight)
            sizing.paddingRight = paddingRight;
    });
    return sizing;
}
// Apply reference styles to a heading element
function applyRefStyles(heading, ref) {
    for (const key in ref) {
        const val = ref[key];
        if (val) {
            heading.style.setProperty(keyMap[key], val);
        }
    }
}
class HeadingsManager {
    constructor() {
        this.headings = {};
        this.previewSizerRef = null;
        this.codeMirrorSizerRef = null;
        this.codeMirrorSizerInvalid = true;
    }
    getPreviewSizerStyles() {
        const el = document.getElementsByClassName("markdown-preview-sizer");
        if (el.length) {
            this.previewSizerRef = getRefSizing(el[0]);
        }
    }
    getCodeMirrorSizerStyles() {
        const sizerEl = document.getElementsByClassName("CodeMirror-sizer");
        const lineEl = document.getElementsByClassName("CodeMirror-line");
        if (sizerEl.length && lineEl.length) {
            const sizer = sizerEl[0];
            const { marginLeft, paddingRight, borderRightWidth } = sizer.style;
            // If codemirror hasn't applied styles to the div yet, let's consider it 
            // invalid so we can check it again later
            if (marginLeft !== "0px" && paddingRight !== "0px") {
                this.codeMirrorSizerInvalid = false;
            }
            const inline = {
                marginLeft,
                marginRight: borderRightWidth,
                paddingRight,
            };
            const sizerRef = getRefSizing(sizer);
            const line = lineEl[0];
            const lineRef = getRefSizing(line);
            // Combine inline styles with CSS styles
            this.codeMirrorSizerRef = Object.assign(Object.assign({}, inline), sizerRef);
            if (lineRef.paddingLeft) {
                this.codeMirrorSizerRef.paddingLeft = this.codeMirrorSizerRef
                    .paddingLeft
                    ? `calc(${this.codeMirrorSizerRef.paddingLeft} + ${lineRef.paddingLeft})`
                    : lineRef.paddingLeft;
            }
            if (lineRef.paddingRight) {
                this.codeMirrorSizerRef.paddingRight = this.codeMirrorSizerRef
                    .paddingRight
                    ? `calc(${this.codeMirrorSizerRef.paddingRight} + ${lineRef.paddingRight})`
                    : lineRef.paddingRight;
            }
        }
    }
    // Once the codemirror heading styles have been validated, loop through and update everything
    updateCodeMirrorHeadings() {
        Object.keys(this.headings).forEach((id) => {
            const h1Edit = document.getElementById(`${id}-edit`);
            applyRefStyles(h1Edit, this.codeMirrorSizerRef);
        });
    }
    // Clean up headings once a pane has been closed or the plugin has been disabled
    removeHeading(id) {
        if (!this.headings[id])
            return;
        const h1Edit = document.getElementById(`${id}-edit`);
        const h1Preview = document.getElementById(`${id}-preview`);
        if (h1Edit)
            h1Edit.remove();
        if (h1Preview)
            h1Preview.remove();
        this.headings[id].resizeWatcher.disconnect();
        delete this.headings[id].resizeWatcher;
        delete this.headings[id];
    }
    createHeading(id, leaf) {
        var _a, _b;
        // CodeMirror adds margin and padding only after the editor is visible
        if (this.codeMirrorSizerInvalid &&
            ((_a = leaf.getViewState().state) === null || _a === void 0 ? void 0 : _a.mode) === "source") {
            this.getCodeMirrorSizerStyles();
            if (!this.codeMirrorSizerInvalid) {
                this.updateCodeMirrorHeadings();
            }
        }
        if (this.headings[id])
            return;
        const title = (_b = leaf.view.file) === null || _b === void 0 ? void 0 : _b.basename;
        if (!title)
            return;
        const viewContent = leaf.view.containerEl.getElementsByClassName("CodeMirror-scroll");
        const lines = leaf.view.containerEl.getElementsByClassName("CodeMirror-lines");
        const previewContent = leaf.view.containerEl.getElementsByClassName("markdown-preview-view");
        if (!this.previewSizerRef) {
            this.getPreviewSizerStyles();
        }
        if (!this.codeMirrorSizerRef) {
            this.getCodeMirrorSizerStyles();
        }
        if (viewContent.length && previewContent.length) {
            // Create the codemirror heading
            const editEl = viewContent[0];
            const h1Edit = document.createElement("h1");
            applyRefStyles(h1Edit, this.codeMirrorSizerRef);
            h1Edit.setText(title);
            h1Edit.id = `${id}-edit`;
            editEl.prepend(h1Edit);
            const onResize = obsidian.debounce((entries) => {
                if (lines.length) {
                    const linesEl = lines[0];
                    const height = Math.ceil(entries[0].borderBoxSize[0].blockSize);
                    linesEl.style.paddingTop = `${height}px`;
                    h1Edit.style.marginBottom = `-${height}px`;
                }
            }, 20, true);
            // We need to push the content down when the pane resizes so the heading
            // doesn't cover the content
            const resizeWatcher = new window.ResizeObserver(onResize);
            resizeWatcher.observe(h1Edit);
            // Create the preview heading
            const previewEl = previewContent[0];
            const h1Preview = document.createElement("h1");
            applyRefStyles(h1Preview, this.previewSizerRef);
            h1Preview.setText(title);
            h1Preview.id = `${id}-preview`;
            previewEl.prepend(h1Preview);
            this.headings[id] = { leaf, resizeWatcher };
        }
    }
    // Generate a unique ID for a leaf
    getLeafId(leaf) {
        const viewState = leaf.getViewState();
        if (viewState.type === "markdown") {
            return ("title-" +
                (leaf.id + viewState.state.file).replace(/^[^a-z]+|[^\w:.-]+/gi, ""));
        }
        return null;
    }
    // Iterate through all leafs and generate headings if needed
    createHeadings(app) {
        const seen = {};
        app.workspace.iterateRootLeaves((leaf) => {
            const id = this.getLeafId(leaf);
            if (id) {
                this.createHeading(id, leaf);
                seen[id] = true;
            }
        });
        Object.keys(this.headings).forEach((id) => {
            if (!seen[id]) {
                this.removeHeading(id);
            }
        });
    }
    cleanup() {
        this.previewSizerRef = null;
        this.codeMirrorSizerRef = null;
        Object.keys(this.headings).forEach((id) => {
            this.removeHeading(id);
        });
    }
}

class EmbeddedNoteTitlesPlugin extends obsidian.Plugin {
    onload() {
        document.body.classList.add("embedded-note-titles");
        this.headingsManager = new HeadingsManager();
        this.registerEvent(this.app.workspace.on("layout-change", () => {
            setTimeout(() => {
                this.headingsManager.createHeadings(this.app);
            }, 0);
        }));
        // Listen for CSS changes so we can recalculate heading styles
        this.registerEvent(this.app.workspace.on("css-change", () => {
            this.headingsManager.cleanup();
            setTimeout(() => {
                this.headingsManager.createHeadings(this.app);
            }, 0);
        }));
        this.app.workspace.layoutReady
            ? this.app.workspace.trigger("layout-change")
            : this.app.workspace.onLayoutReady(() => {
                // Trigger layout-change to ensure headings are created when the app loads
                this.app.workspace.trigger("layout-change");
            });
    }
    onunload() {
        document.body.classList.remove("embedded-note-titles");
        this.headingsManager.cleanup();
    }
}

module.exports = EmbeddedNoteTitlesPlugin;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXMiOlsic3JjL2dldE1hdGNoZWRDU1NSdWxlcy50cyIsInNyYy9IZWFkaW5nc01hbmFnZXIudHMiLCJzcmMvbWFpbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBFTEVNRU5UX1JFID0gL1tcXHctXSsvZztcbmNvbnN0IElEX1JFID0gLyNbXFx3LV0rL2c7XG5jb25zdCBDTEFTU19SRSA9IC9cXC5bXFx3LV0rL2c7XG5jb25zdCBBVFRSX1JFID0gL1xcW1teXFxdXStcXF0vZztcbmNvbnN0IFBTRVVET19DTEFTU0VTX1JFID0gL1xcOig/IW5vdClbXFx3LV0rKFxcKC4qXFwpKT8vZztcbmNvbnN0IFBTRVVET19FTEVNRU5UU19SRSA9IC9cXDpcXDo/KGFmdGVyfGJlZm9yZXxmaXJzdC1sZXR0ZXJ8Zmlyc3QtbGluZXxzZWxlY3Rpb24pL2c7XG5cbi8vIGNvbnZlcnQgYW4gYXJyYXktbGlrZSBvYmplY3QgdG8gYXJyYXlcbmZ1bmN0aW9uIHRvQXJyYXkobGlzdDogYW55KSB7XG4gIHJldHVybiBbXS5zbGljZS5jYWxsKGxpc3QpO1xufVxuXG4vLyBoYW5kbGVzIGV4dHJhY3Rpb24gb2YgYGNzc1J1bGVzYCBhcyBhbiBgQXJyYXlgIGZyb20gYSBzdHlsZXNoZWV0IG9yIHNvbWV0aGluZyB0aGF0IGJlaGF2ZXMgdGhlIHNhbWVcbmZ1bmN0aW9uIGdldFNoZWV0UnVsZXMoc3R5bGVzaGVldDogQ1NTU3R5bGVTaGVldCkge1xuICB2YXIgc2hlZXRfbWVkaWEgPSBzdHlsZXNoZWV0Lm1lZGlhICYmIHN0eWxlc2hlZXQubWVkaWEubWVkaWFUZXh0O1xuICAvLyBpZiB0aGlzIHNoZWV0IGlzIGRpc2FibGVkIHNraXAgaXRcbiAgaWYgKHN0eWxlc2hlZXQuZGlzYWJsZWQpIHJldHVybiBbXTtcbiAgLy8gaWYgdGhpcyBzaGVldCdzIG1lZGlhIGlzIHNwZWNpZmllZCBhbmQgZG9lc24ndCBtYXRjaCB0aGUgdmlld3BvcnQgdGhlbiBza2lwIGl0XG4gIGlmIChcbiAgICBzaGVldF9tZWRpYSAmJlxuICAgIHNoZWV0X21lZGlhLmxlbmd0aCAmJlxuICAgICF3aW5kb3cubWF0Y2hNZWRpYShzaGVldF9tZWRpYSkubWF0Y2hlc1xuICApXG4gICAgcmV0dXJuIFtdO1xuICAvLyBnZXQgdGhlIHN0eWxlIHJ1bGVzIG9mIHRoaXMgc2hlZXRcbiAgcmV0dXJuIHRvQXJyYXkoc3R5bGVzaGVldC5jc3NSdWxlcyk7XG59XG5cbmZ1bmN0aW9uIF9maW5kKHN0cmluZzogc3RyaW5nLCByZTogUmVnRXhwKSB7XG4gIHZhciBtYXRjaGVzID0gc3RyaW5nLm1hdGNoKHJlKTtcbiAgcmV0dXJuIG1hdGNoZXMgPyBtYXRjaGVzLmxlbmd0aCA6IDA7XG59XG5cbi8vIGNhbGN1bGF0ZXMgdGhlIHNwZWNpZmljaXR5IG9mIGEgZ2l2ZW4gYHNlbGVjdG9yYFxuZnVuY3Rpb24gY2FsY3VsYXRlU2NvcmUoc2VsZWN0b3I6IHN0cmluZykge1xuICB2YXIgc2NvcmUgPSBbMCwgMCwgMF0sXG4gICAgcGFydHMgPSBzZWxlY3Rvci5zcGxpdChcIiBcIiksXG4gICAgcGFydCxcbiAgICBtYXRjaDtcbiAgLy9UT0RPOiBjbGVhbiB0aGUgJzpub3QnIHBhcnQgc2luY2UgdGhlIGxhc3QgRUxFTUVOVF9SRSB3aWxsIHBpY2sgaXQgdXBcbiAgd2hpbGUgKCgocGFydCA9IHBhcnRzLnNoaWZ0KCkpLCB0eXBlb2YgcGFydCA9PSBcInN0cmluZ1wiKSkge1xuICAgIC8vIGZpbmQgYWxsIHBzZXVkby1lbGVtZW50c1xuICAgIG1hdGNoID0gX2ZpbmQocGFydCwgUFNFVURPX0VMRU1FTlRTX1JFKTtcbiAgICBzY29yZVsyXSArPSBtYXRjaDtcbiAgICAvLyBhbmQgcmVtb3ZlIHRoZW1cbiAgICBtYXRjaCAmJiAocGFydCA9IHBhcnQucmVwbGFjZShQU0VVRE9fRUxFTUVOVFNfUkUsIFwiXCIpKTtcbiAgICAvLyBmaW5kIGFsbCBwc2V1ZG8tY2xhc3Nlc1xuICAgIG1hdGNoID0gX2ZpbmQocGFydCwgUFNFVURPX0NMQVNTRVNfUkUpO1xuICAgIHNjb3JlWzFdICs9IG1hdGNoO1xuICAgIC8vIGFuZCByZW1vdmUgdGhlbVxuICAgIG1hdGNoICYmIChwYXJ0ID0gcGFydC5yZXBsYWNlKFBTRVVET19DTEFTU0VTX1JFLCBcIlwiKSk7XG4gICAgLy8gZmluZCBhbGwgYXR0cmlidXRlc1xuICAgIG1hdGNoID0gX2ZpbmQocGFydCwgQVRUUl9SRSk7XG4gICAgc2NvcmVbMV0gKz0gbWF0Y2g7XG4gICAgLy8gYW5kIHJlbW92ZSB0aGVtXG4gICAgbWF0Y2ggJiYgKHBhcnQgPSBwYXJ0LnJlcGxhY2UoQVRUUl9SRSwgXCJcIikpO1xuICAgIC8vIGZpbmQgYWxsIElEc1xuICAgIG1hdGNoID0gX2ZpbmQocGFydCwgSURfUkUpO1xuICAgIHNjb3JlWzBdICs9IG1hdGNoO1xuICAgIC8vIGFuZCByZW1vdmUgdGhlbVxuICAgIG1hdGNoICYmIChwYXJ0ID0gcGFydC5yZXBsYWNlKElEX1JFLCBcIlwiKSk7XG4gICAgLy8gZmluZCBhbGwgY2xhc3Nlc1xuICAgIG1hdGNoID0gX2ZpbmQocGFydCwgQ0xBU1NfUkUpO1xuICAgIHNjb3JlWzFdICs9IG1hdGNoO1xuICAgIC8vIGFuZCByZW1vdmUgdGhlbVxuICAgIG1hdGNoICYmIChwYXJ0ID0gcGFydC5yZXBsYWNlKENMQVNTX1JFLCBcIlwiKSk7XG4gICAgLy8gZmluZCBhbGwgZWxlbWVudHNcbiAgICBzY29yZVsyXSArPSBfZmluZChwYXJ0LCBFTEVNRU5UX1JFKTtcbiAgfVxuICByZXR1cm4gcGFyc2VJbnQoc2NvcmUuam9pbihcIlwiKSwgMTApO1xufVxuXG4vLyByZXR1cm5zIHRoZSBoZWlnaHRzIHBvc3NpYmxlIHNwZWNpZmljaXR5IHNjb3JlIGFuIGVsZW1lbnQgY2FuIGdldCBmcm9tIGEgZ2l2ZSBydWxlJ3Mgc2VsZWN0b3JUZXh0XG5mdW5jdGlvbiBnZXRTcGVjaWZpY2l0eVNjb3JlKGVsZW1lbnQ6IEhUTUxFbGVtZW50LCBzZWxlY3RvclRleHQ6IHN0cmluZykge1xuICB2YXIgc2VsZWN0b3JzID0gc2VsZWN0b3JUZXh0LnNwbGl0KFwiLFwiKSxcbiAgICBzZWxlY3RvcixcbiAgICBzY29yZSxcbiAgICByZXN1bHQgPSAwO1xuXG4gIHdoaWxlICgoc2VsZWN0b3IgPSBzZWxlY3RvcnMuc2hpZnQoKSkpIHtcbiAgICBpZiAoZWxlbWVudC5tYXRjaGVzKHNlbGVjdG9yKSkge1xuICAgICAgc2NvcmUgPSBjYWxjdWxhdGVTY29yZShzZWxlY3Rvcik7XG4gICAgICByZXN1bHQgPSBzY29yZSA+IHJlc3VsdCA/IHNjb3JlIDogcmVzdWx0O1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmZ1bmN0aW9uIHNvcnRCeVNwZWNpZmljaXR5KGVsZW1lbnQ6IEhUTUxFbGVtZW50LCBydWxlczogQ1NTU3R5bGVSdWxlW10pIHtcbiAgLy8gY29tcGFyaW5nIGZ1bmN0aW9uIHRoYXQgc29ydHMgQ1NTU3R5bGVSdWxlcyBhY2NvcmRpbmcgdG8gc3BlY2lmaWNpdHkgb2YgdGhlaXIgYHNlbGVjdG9yVGV4dGBcbiAgZnVuY3Rpb24gY29tcGFyZVNwZWNpZmljaXR5KGE6IENTU1N0eWxlUnVsZSwgYjogQ1NTU3R5bGVSdWxlKSB7XG4gICAgbGV0IGFTY29yZSA9IGdldFNwZWNpZmljaXR5U2NvcmUoZWxlbWVudCwgYS5zZWxlY3RvclRleHQpO1xuICAgIGxldCBiU2NvcmUgPSBnZXRTcGVjaWZpY2l0eVNjb3JlKGVsZW1lbnQsIGIuc2VsZWN0b3JUZXh0KTtcblxuICAgIC8vIElmIHRoZSBzdHlsZXMgY29tZSBmcm9tIGFwcC5jc3MsIHRoZXkgdGFrZSBhIGxvd2VyIHByaW9yaXR5XG4gICAgaWYgKGFTY29yZSA9PT0gYlNjb3JlKSB7XG4gICAgICBpZiAoYS5wYXJlbnRTdHlsZVNoZWV0LmhyZWYpIGFTY29yZSAtPSAxO1xuICAgICAgaWYgKGIucGFyZW50U3R5bGVTaGVldC5ocmVmKSBiU2NvcmUgLT0gMTtcbiAgICB9XG5cbiAgICByZXR1cm4gKFxuICAgICAgYVNjb3JlIC1cbiAgICAgIGJTY29yZVxuICAgICk7XG4gIH1cblxuICByZXR1cm4gcnVsZXMuc29ydChjb21wYXJlU3BlY2lmaWNpdHkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0TWF0Y2hlZENTU1J1bGVzKGVsZW1lbnQ6IEhUTUxFbGVtZW50KTogQ1NTU3R5bGVSdWxlW10ge1xuICBsZXQgc3R5bGVTaGVldHMgPSB0b0FycmF5KHdpbmRvdy5kb2N1bWVudC5zdHlsZVNoZWV0cylcbiAgbGV0IHNoZWV0O1xuICBsZXQgcnVsZXM7XG4gIGxldCBydWxlO1xuICBsZXQgcmVzdWx0OiBDU1NTdHlsZVJ1bGVbXSA9IFtdO1xuXG4gIC8vIGFzc3VtaW5nIHRoZSBicm93c2VyIGhhbmRzIHVzIHN0eWxlc2hlZXRzIGluIG9yZGVyIG9mIGFwcGVhcmFuY2VcbiAgLy8gd2UgaXRlcmF0ZSB0aGVtIGZyb20gdGhlIGJlZ2lubmluZyB0byBmb2xsb3cgcHJvcGVyIGNhc2NhZGUgb3JkZXJcbiAgd2hpbGUgKChzaGVldCA9IHN0eWxlU2hlZXRzLnNoaWZ0KCkpKSB7XG4gICAgLy8gZ2V0IHRoZSBzdHlsZSBydWxlcyBvZiB0aGlzIHNoZWV0XG4gICAgcnVsZXMgPSBnZXRTaGVldFJ1bGVzKHNoZWV0KTtcbiAgICAvLyBsb29wIHRoZSBydWxlcyBpbiBvcmRlciBvZiBhcHBlYXJhbmNlXG4gICAgd2hpbGUgKChydWxlID0gcnVsZXMuc2hpZnQoKSkpIHtcbiAgICAgIC8vIGlmIHRoaXMgaXMgYW4gQGltcG9ydCBydWxlXG4gICAgICBpZiAocnVsZS5zdHlsZVNoZWV0KSB7XG4gICAgICAgIC8vIGluc2VydCB0aGUgaW1wb3J0ZWQgc3R5bGVzaGVldCdzIHJ1bGVzIGF0IHRoZSBiZWdpbm5pbmcgb2YgdGhpcyBzdHlsZXNoZWV0J3MgcnVsZXNcbiAgICAgICAgcnVsZXMgPSBnZXRTaGVldFJ1bGVzKHJ1bGUuc3R5bGVTaGVldCkuY29uY2F0KHJ1bGVzKTtcbiAgICAgICAgLy8gYW5kIHNraXAgdGhpcyBydWxlXG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgLy8gaWYgdGhlcmUncyBubyBzdHlsZXNoZWV0IGF0dHJpYnV0ZSBCVVQgdGhlcmUgSVMgYSBtZWRpYSBhdHRyaWJ1dGUgaXQncyBhIG1lZGlhIHJ1bGVcbiAgICAgIGVsc2UgaWYgKHJ1bGUubWVkaWEpIHtcbiAgICAgICAgLy8gaW5zZXJ0IHRoZSBjb250YWluZWQgcnVsZXMgb2YgdGhpcyBtZWRpYSBydWxlIHRvIHRoZSBiZWdpbm5pbmcgb2YgdGhpcyBzdHlsZXNoZWV0J3MgcnVsZXNcbiAgICAgICAgcnVsZXMgPSBnZXRTaGVldFJ1bGVzKHJ1bGUpLmNvbmNhdChydWxlcyk7XG4gICAgICAgIC8vIGFuZCBza2lwIGl0XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICAvLyBjaGVjayBpZiB0aGlzIGVsZW1lbnQgbWF0Y2hlcyB0aGlzIHJ1bGUncyBzZWxlY3RvclxuICAgICAgaWYgKGVsZW1lbnQubWF0Y2hlcyhydWxlLnNlbGVjdG9yVGV4dCkpIHtcbiAgICAgICAgLy8gcHVzaCB0aGUgcnVsZSB0byB0aGUgcmVzdWx0cyBzZXRcbiAgICAgICAgcmVzdWx0LnB1c2gocnVsZSk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIC8vIHNvcnQgYWNjb3JkaW5nIHRvIHNwZWNpZmljaXR5XG4gIHJldHVybiBzb3J0QnlTcGVjaWZpY2l0eShlbGVtZW50LCByZXN1bHQpO1xufVxuIiwiaW1wb3J0IHsgQXBwLCBXb3Jrc3BhY2VMZWFmLCBkZWJvdW5jZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgZ2V0TWF0Y2hlZENTU1J1bGVzIH0gZnJvbSBcIi4vZ2V0TWF0Y2hlZENTU1J1bGVzXCI7XG5cbmludGVyZmFjZSBSZWZTaXppbmcge1xuICB3aWR0aD86IHN0cmluZztcbiAgbWF4V2lkdGg/OiBzdHJpbmc7XG4gIG1hcmdpbkxlZnQ/OiBzdHJpbmc7XG4gIG1hcmdpblJpZ2h0Pzogc3RyaW5nO1xuICBwYWRkaW5nTGVmdD86IHN0cmluZztcbiAgcGFkZGluZ1JpZ2h0Pzogc3RyaW5nO1xufVxuXG4vLyBTcGxpdCBDU1MgbWFyZ2luIGFuZCBwYWRkaW5nIHZhbHVlcyBsaWtlIGAwIGF1dG9gLCBgMTBweCBhdXRvIDBgLCBldGMuXG5mdW5jdGlvbiBnZXRSaWdodExlZnQodmFsOiBzdHJpbmcpIHtcbiAgaWYgKC9cXHMvLnRlc3QodmFsKSkge1xuICAgIGNvbnN0IHZhbHMgPSB2YWwuc3BsaXQoL1xccysvZyk7XG5cbiAgICBpZiAodmFscy5sZW5ndGggPT09IDIgfHwgdmFscy5sZW5ndGggPT09IDMpIHtcbiAgICAgIHJldHVybiBbdmFsc1sxXSwgdmFsc1sxXV07XG4gICAgfVxuXG4gICAgaWYgKHZhbHMubGVuZ3RoID09PSA0KSB7XG4gICAgICByZXR1cm4gW3ZhbHNbMV0sIHZhbHNbM11dO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBbdmFsLCB2YWxdO1xufVxuXG5jb25zdCBrZXlNYXA6IHsgW2s6IHN0cmluZ106IHN0cmluZyB9ID0ge1xuICB3aWR0aDogXCJ3aWR0aFwiLFxuICBtYXhXaWR0aDogXCJtYXgtd2lkdGhcIixcbiAgbWFyZ2luOiBcIm1hcmdpblwiLFxuICBtYXJnaW5MZWZ0OiBcIm1hcmdpbi1sZWZ0XCIsXG4gIG1hcmdpblJpZ2h0OiBcIm1hcmdpbi1yaWdodFwiLFxuICBwYWRkaW5nOiBcInBhZGRpbmdcIixcbiAgcGFkZGluZ0xlZnQ6IFwicGFkZGluZy1sZWZ0XCIsXG4gIHBhZGRpbmdSaWdodDogXCJwYWRkaW5nLXJpZ2h0XCIsXG59O1xuXG4vLyBHZXQgdGhlIHJlbGV2YW50IHN0eWxlIHZhbHVlcyBmcm9tIGEgcmVmZXJlbmNlIGVsZW1lbnRcbmZ1bmN0aW9uIGdldFJlZlNpemluZyhlbDogSFRNTEVsZW1lbnQpIHtcbiAgY29uc3QgcnVsZXMgPSBnZXRNYXRjaGVkQ1NTUnVsZXMoZWwpO1xuICBjb25zdCBzaXppbmc6IFJlZlNpemluZyA9IHt9O1xuXG4gIHJ1bGVzLmZvckVhY2goKHIpID0+IHtcbiAgICBjb25zdCB7XG4gICAgICB3aWR0aCxcbiAgICAgIG1heFdpZHRoLFxuICAgICAgbWFyZ2luLFxuICAgICAgbWFyZ2luTGVmdCxcbiAgICAgIG1hcmdpblJpZ2h0LFxuICAgICAgcGFkZGluZyxcbiAgICAgIHBhZGRpbmdMZWZ0LFxuICAgICAgcGFkZGluZ1JpZ2h0LFxuICAgIH0gPSByLnN0eWxlO1xuXG4gICAgaWYgKHdpZHRoKSB7XG4gICAgICBzaXppbmcud2lkdGggPSB3aWR0aDtcbiAgICB9XG5cbiAgICBpZiAobWF4V2lkdGgpIHtcbiAgICAgIHNpemluZy5tYXhXaWR0aCA9IG1heFdpZHRoO1xuICAgIH1cblxuICAgIGlmIChtYXJnaW4pIHtcbiAgICAgIGNvbnN0IFttUmlnaHQsIG1MZWZ0XSA9IGdldFJpZ2h0TGVmdChtYXJnaW4pO1xuICAgICAgc2l6aW5nLm1hcmdpbkxlZnQgPSBtTGVmdDtcbiAgICAgIHNpemluZy5tYXJnaW5MZWZ0ID0gbVJpZ2h0O1xuICAgIH1cblxuICAgIGlmIChtYXJnaW5MZWZ0KSBzaXppbmcubWFyZ2luTGVmdCA9IG1hcmdpbkxlZnQ7XG4gICAgaWYgKG1hcmdpblJpZ2h0KSBzaXppbmcubWFyZ2luUmlnaHQgPSBtYXJnaW5SaWdodDtcblxuICAgIGlmIChwYWRkaW5nKSB7XG4gICAgICBjb25zdCBbcFJpZ2h0LCBwTGVmdF0gPSBnZXRSaWdodExlZnQocGFkZGluZyk7XG4gICAgICBzaXppbmcucGFkZGluZ0xlZnQgPSBwTGVmdDtcbiAgICAgIHNpemluZy5wYWRkaW5nTGVmdCA9IHBSaWdodDtcbiAgICB9XG5cbiAgICBpZiAocGFkZGluZ0xlZnQpIHNpemluZy5wYWRkaW5nTGVmdCA9IHBhZGRpbmdMZWZ0O1xuICAgIGlmIChwYWRkaW5nUmlnaHQpIHNpemluZy5wYWRkaW5nUmlnaHQgPSBwYWRkaW5nUmlnaHQ7XG4gIH0pO1xuXG4gIHJldHVybiBzaXppbmc7XG59XG5cbi8vIEFwcGx5IHJlZmVyZW5jZSBzdHlsZXMgdG8gYSBoZWFkaW5nIGVsZW1lbnRcbmZ1bmN0aW9uIGFwcGx5UmVmU3R5bGVzKGhlYWRpbmc6IEhUTUxFbGVtZW50LCByZWY6IFJlZlNpemluZykge1xuICBmb3IgKGNvbnN0IGtleSBpbiByZWYpIHtcbiAgICBjb25zdCB2YWwgPSByZWZba2V5IGFzIGtleW9mIFJlZlNpemluZ107XG5cbiAgICBpZiAodmFsKSB7XG4gICAgICBoZWFkaW5nLnN0eWxlLnNldFByb3BlcnR5KGtleU1hcFtrZXldLCB2YWwpO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgSGVhZGluZ3NNYW5hZ2VyIHtcbiAgaGVhZGluZ3M6IHtcbiAgICBbaWQ6IHN0cmluZ106IHtcbiAgICAgIGxlYWY6IFdvcmtzcGFjZUxlYWY7XG4gICAgICByZXNpemVXYXRjaGVyOiBSZXNpemVPYnNlcnZlcjtcbiAgICB9O1xuICB9ID0ge307XG5cbiAgcHJldmlld1NpemVyUmVmOiBSZWZTaXppbmcgfCBudWxsID0gbnVsbDtcbiAgY29kZU1pcnJvclNpemVyUmVmOiBSZWZTaXppbmcgfCBudWxsID0gbnVsbDtcbiAgY29kZU1pcnJvclNpemVySW52YWxpZDogYm9vbGVhbiA9IHRydWU7XG5cbiAgZ2V0UHJldmlld1NpemVyU3R5bGVzKCkge1xuICAgIGNvbnN0IGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcIm1hcmtkb3duLXByZXZpZXctc2l6ZXJcIik7XG5cbiAgICBpZiAoZWwubGVuZ3RoKSB7XG4gICAgICB0aGlzLnByZXZpZXdTaXplclJlZiA9IGdldFJlZlNpemluZyhlbFswXSBhcyBIVE1MRWxlbWVudCk7XG4gICAgfVxuICB9XG5cbiAgZ2V0Q29kZU1pcnJvclNpemVyU3R5bGVzKCkge1xuICAgIGNvbnN0IHNpemVyRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwiQ29kZU1pcnJvci1zaXplclwiKTtcbiAgICBjb25zdCBsaW5lRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwiQ29kZU1pcnJvci1saW5lXCIpO1xuXG4gICAgaWYgKHNpemVyRWwubGVuZ3RoICYmIGxpbmVFbC5sZW5ndGgpIHtcbiAgICAgIGNvbnN0IHNpemVyID0gc2l6ZXJFbFswXSBhcyBIVE1MRWxlbWVudDtcblxuICAgICAgY29uc3QgeyBtYXJnaW5MZWZ0LCBwYWRkaW5nUmlnaHQsIGJvcmRlclJpZ2h0V2lkdGggfSA9IHNpemVyLnN0eWxlO1xuXG4gICAgICAvLyBJZiBjb2RlbWlycm9yIGhhc24ndCBhcHBsaWVkIHN0eWxlcyB0byB0aGUgZGl2IHlldCwgbGV0J3MgY29uc2lkZXIgaXQgXG4gICAgICAvLyBpbnZhbGlkIHNvIHdlIGNhbiBjaGVjayBpdCBhZ2FpbiBsYXRlclxuICAgICAgaWYgKG1hcmdpbkxlZnQgIT09IFwiMHB4XCIgJiYgcGFkZGluZ1JpZ2h0ICE9PSBcIjBweFwiKSB7XG4gICAgICAgIHRoaXMuY29kZU1pcnJvclNpemVySW52YWxpZCA9IGZhbHNlO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBpbmxpbmU6IFJlZlNpemluZyA9IHtcbiAgICAgICAgbWFyZ2luTGVmdCxcbiAgICAgICAgbWFyZ2luUmlnaHQ6IGJvcmRlclJpZ2h0V2lkdGgsXG4gICAgICAgIHBhZGRpbmdSaWdodCxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHNpemVyUmVmID0gZ2V0UmVmU2l6aW5nKHNpemVyKTtcblxuICAgICAgY29uc3QgbGluZSA9IGxpbmVFbFswXSBhcyBIVE1MRWxlbWVudDtcbiAgICAgIGNvbnN0IGxpbmVSZWYgPSBnZXRSZWZTaXppbmcobGluZSk7XG5cbiAgICAgIC8vIENvbWJpbmUgaW5saW5lIHN0eWxlcyB3aXRoIENTUyBzdHlsZXNcbiAgICAgIHRoaXMuY29kZU1pcnJvclNpemVyUmVmID0ge1xuICAgICAgICAuLi5pbmxpbmUsXG4gICAgICAgIC4uLnNpemVyUmVmLFxuICAgICAgfTtcblxuICAgICAgaWYgKGxpbmVSZWYucGFkZGluZ0xlZnQpIHtcbiAgICAgICAgdGhpcy5jb2RlTWlycm9yU2l6ZXJSZWYucGFkZGluZ0xlZnQgPSB0aGlzLmNvZGVNaXJyb3JTaXplclJlZlxuICAgICAgICAgIC5wYWRkaW5nTGVmdFxuICAgICAgICAgID8gYGNhbGMoJHt0aGlzLmNvZGVNaXJyb3JTaXplclJlZi5wYWRkaW5nTGVmdH0gKyAke2xpbmVSZWYucGFkZGluZ0xlZnR9KWBcbiAgICAgICAgICA6IGxpbmVSZWYucGFkZGluZ0xlZnQ7XG4gICAgICB9XG5cbiAgICAgIGlmIChsaW5lUmVmLnBhZGRpbmdSaWdodCkge1xuICAgICAgICB0aGlzLmNvZGVNaXJyb3JTaXplclJlZi5wYWRkaW5nUmlnaHQgPSB0aGlzLmNvZGVNaXJyb3JTaXplclJlZlxuICAgICAgICAgIC5wYWRkaW5nUmlnaHRcbiAgICAgICAgICA/IGBjYWxjKCR7dGhpcy5jb2RlTWlycm9yU2l6ZXJSZWYucGFkZGluZ1JpZ2h0fSArICR7bGluZVJlZi5wYWRkaW5nUmlnaHR9KWBcbiAgICAgICAgICA6IGxpbmVSZWYucGFkZGluZ1JpZ2h0O1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG5cbiAgLy8gT25jZSB0aGUgY29kZW1pcnJvciBoZWFkaW5nIHN0eWxlcyBoYXZlIGJlZW4gdmFsaWRhdGVkLCBsb29wIHRocm91Z2ggYW5kIHVwZGF0ZSBldmVyeXRoaW5nXG4gIHVwZGF0ZUNvZGVNaXJyb3JIZWFkaW5ncygpIHtcbiAgICBPYmplY3Qua2V5cyh0aGlzLmhlYWRpbmdzKS5mb3JFYWNoKChpZCkgPT4ge1xuICAgICAgY29uc3QgaDFFZGl0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7aWR9LWVkaXRgKTtcbiAgICAgIGFwcGx5UmVmU3R5bGVzKGgxRWRpdCwgdGhpcy5jb2RlTWlycm9yU2l6ZXJSZWYpO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gQ2xlYW4gdXAgaGVhZGluZ3Mgb25jZSBhIHBhbmUgaGFzIGJlZW4gY2xvc2VkIG9yIHRoZSBwbHVnaW4gaGFzIGJlZW4gZGlzYWJsZWRcbiAgcmVtb3ZlSGVhZGluZyhpZDogc3RyaW5nKSB7XG4gICAgaWYgKCF0aGlzLmhlYWRpbmdzW2lkXSkgcmV0dXJuO1xuXG4gICAgY29uc3QgaDFFZGl0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7aWR9LWVkaXRgKTtcbiAgICBjb25zdCBoMVByZXZpZXcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgJHtpZH0tcHJldmlld2ApO1xuXG4gICAgaWYgKGgxRWRpdCkgaDFFZGl0LnJlbW92ZSgpO1xuICAgIGlmIChoMVByZXZpZXcpIGgxUHJldmlldy5yZW1vdmUoKTtcblxuICAgIHRoaXMuaGVhZGluZ3NbaWRdLnJlc2l6ZVdhdGNoZXIuZGlzY29ubmVjdCgpO1xuXG4gICAgZGVsZXRlIHRoaXMuaGVhZGluZ3NbaWRdLnJlc2l6ZVdhdGNoZXI7XG4gICAgZGVsZXRlIHRoaXMuaGVhZGluZ3NbaWRdO1xuICB9XG5cbiAgY3JlYXRlSGVhZGluZyhpZDogc3RyaW5nLCBsZWFmOiBXb3Jrc3BhY2VMZWFmKSB7XG4gICAgLy8gQ29kZU1pcnJvciBhZGRzIG1hcmdpbiBhbmQgcGFkZGluZyBvbmx5IGFmdGVyIHRoZSBlZGl0b3IgaXMgdmlzaWJsZVxuICAgIGlmIChcbiAgICAgIHRoaXMuY29kZU1pcnJvclNpemVySW52YWxpZCAmJlxuICAgICAgbGVhZi5nZXRWaWV3U3RhdGUoKS5zdGF0ZT8ubW9kZSA9PT0gXCJzb3VyY2VcIlxuICAgICkge1xuICAgICAgdGhpcy5nZXRDb2RlTWlycm9yU2l6ZXJTdHlsZXMoKTtcblxuICAgICAgaWYgKCF0aGlzLmNvZGVNaXJyb3JTaXplckludmFsaWQpIHtcbiAgICAgICAgdGhpcy51cGRhdGVDb2RlTWlycm9ySGVhZGluZ3MoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodGhpcy5oZWFkaW5nc1tpZF0pIHJldHVybjtcblxuICAgIGNvbnN0IHRpdGxlID0gKGxlYWYudmlldyBhcyBhbnkpLmZpbGU/LmJhc2VuYW1lO1xuXG4gICAgaWYgKCF0aXRsZSkgcmV0dXJuO1xuXG4gICAgY29uc3Qgdmlld0NvbnRlbnQgPSBsZWFmLnZpZXcuY29udGFpbmVyRWwuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcbiAgICAgIFwiQ29kZU1pcnJvci1zY3JvbGxcIlxuICAgICk7XG5cbiAgICBjb25zdCBsaW5lcyA9IGxlYWYudmlldy5jb250YWluZXJFbC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFxuICAgICAgXCJDb2RlTWlycm9yLWxpbmVzXCJcbiAgICApO1xuXG4gICAgY29uc3QgcHJldmlld0NvbnRlbnQgPSBsZWFmLnZpZXcuY29udGFpbmVyRWwuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcbiAgICAgIFwibWFya2Rvd24tcHJldmlldy12aWV3XCJcbiAgICApO1xuXG4gICAgaWYgKCF0aGlzLnByZXZpZXdTaXplclJlZikge1xuICAgICAgdGhpcy5nZXRQcmV2aWV3U2l6ZXJTdHlsZXMoKTtcbiAgICB9XG5cbiAgICBpZiAoIXRoaXMuY29kZU1pcnJvclNpemVyUmVmKSB7XG4gICAgICB0aGlzLmdldENvZGVNaXJyb3JTaXplclN0eWxlcygpO1xuICAgIH1cblxuICAgIGlmICh2aWV3Q29udGVudC5sZW5ndGggJiYgcHJldmlld0NvbnRlbnQubGVuZ3RoKSB7XG4gICAgICAvLyBDcmVhdGUgdGhlIGNvZGVtaXJyb3IgaGVhZGluZ1xuICAgICAgY29uc3QgZWRpdEVsID0gdmlld0NvbnRlbnRbMF0gYXMgSFRNTERpdkVsZW1lbnQ7XG4gICAgICBjb25zdCBoMUVkaXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaDFcIik7XG5cbiAgICAgIGFwcGx5UmVmU3R5bGVzKGgxRWRpdCwgdGhpcy5jb2RlTWlycm9yU2l6ZXJSZWYpO1xuXG4gICAgICBoMUVkaXQuc2V0VGV4dCh0aXRsZSk7XG4gICAgICBoMUVkaXQuaWQgPSBgJHtpZH0tZWRpdGA7XG4gICAgICBlZGl0RWwucHJlcGVuZChoMUVkaXQpO1xuXG4gICAgICBjb25zdCBvblJlc2l6ZSA9IGRlYm91bmNlKChlbnRyaWVzOiBhbnkpID0+IHtcbiAgICAgICAgICBpZiAobGluZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICBjb25zdCBsaW5lc0VsID0gbGluZXNbMF0gYXMgSFRNTERpdkVsZW1lbnQ7XG4gICAgICAgICAgICBjb25zdCBoZWlnaHQgPSBNYXRoLmNlaWwoZW50cmllc1swXS5ib3JkZXJCb3hTaXplWzBdLmJsb2NrU2l6ZSk7XG5cbiAgICAgICAgICAgIGxpbmVzRWwuc3R5bGUucGFkZGluZ1RvcCA9IGAke2hlaWdodH1weGA7XG4gICAgICAgICAgICBoMUVkaXQuc3R5bGUubWFyZ2luQm90dG9tID0gYC0ke2hlaWdodH1weGA7XG4gICAgICAgICAgfVxuICAgICAgfSwgMjAsIHRydWUpXG5cbiAgICAgIC8vIFdlIG5lZWQgdG8gcHVzaCB0aGUgY29udGVudCBkb3duIHdoZW4gdGhlIHBhbmUgcmVzaXplcyBzbyB0aGUgaGVhZGluZ1xuICAgICAgLy8gZG9lc24ndCBjb3ZlciB0aGUgY29udGVudFxuICAgICAgY29uc3QgcmVzaXplV2F0Y2hlciA9IG5ldyAod2luZG93IGFzIGFueSkuUmVzaXplT2JzZXJ2ZXIob25SZXNpemUpO1xuXG4gICAgICByZXNpemVXYXRjaGVyLm9ic2VydmUoaDFFZGl0KTtcbiAgICAgIFxuICAgICAgLy8gQ3JlYXRlIHRoZSBwcmV2aWV3IGhlYWRpbmdcbiAgICAgIGNvbnN0IHByZXZpZXdFbCA9IHByZXZpZXdDb250ZW50WzBdIGFzIEhUTUxEaXZFbGVtZW50O1xuICAgICAgY29uc3QgaDFQcmV2aWV3ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImgxXCIpO1xuXG4gICAgICBhcHBseVJlZlN0eWxlcyhoMVByZXZpZXcsIHRoaXMucHJldmlld1NpemVyUmVmKTtcblxuICAgICAgaDFQcmV2aWV3LnNldFRleHQodGl0bGUpO1xuICAgICAgaDFQcmV2aWV3LmlkID0gYCR7aWR9LXByZXZpZXdgO1xuICAgICAgcHJldmlld0VsLnByZXBlbmQoaDFQcmV2aWV3KTtcblxuICAgICAgdGhpcy5oZWFkaW5nc1tpZF0gPSB7IGxlYWYsIHJlc2l6ZVdhdGNoZXIgfTtcbiAgICB9XG4gIH1cblxuICAvLyBHZW5lcmF0ZSBhIHVuaXF1ZSBJRCBmb3IgYSBsZWFmXG4gIGdldExlYWZJZChsZWFmOiBXb3Jrc3BhY2VMZWFmKSB7XG4gICAgY29uc3Qgdmlld1N0YXRlID0gbGVhZi5nZXRWaWV3U3RhdGUoKTtcblxuICAgIGlmICh2aWV3U3RhdGUudHlwZSA9PT0gXCJtYXJrZG93blwiKSB7XG4gICAgICByZXR1cm4gKFxuICAgICAgICBcInRpdGxlLVwiICtcbiAgICAgICAgKCgobGVhZiBhcyBhbnkpLmlkIGFzIHN0cmluZykgKyB2aWV3U3RhdGUuc3RhdGUuZmlsZSkucmVwbGFjZShcbiAgICAgICAgICAvXlteYS16XSt8W15cXHc6Li1dKy9naSxcbiAgICAgICAgICBcIlwiXG4gICAgICAgIClcbiAgICAgICk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICAvLyBJdGVyYXRlIHRocm91Z2ggYWxsIGxlYWZzIGFuZCBnZW5lcmF0ZSBoZWFkaW5ncyBpZiBuZWVkZWRcbiAgY3JlYXRlSGVhZGluZ3MoYXBwOiBBcHApIHtcbiAgICBjb25zdCBzZWVuOiB7IFtrOiBzdHJpbmddOiBib29sZWFuIH0gPSB7fTtcblxuICAgIGFwcC53b3Jrc3BhY2UuaXRlcmF0ZVJvb3RMZWF2ZXMoKGxlYWYpID0+IHtcbiAgICAgIGNvbnN0IGlkID0gdGhpcy5nZXRMZWFmSWQobGVhZik7XG5cbiAgICAgIGlmIChpZCkge1xuICAgICAgICB0aGlzLmNyZWF0ZUhlYWRpbmcoaWQsIGxlYWYpO1xuICAgICAgICBzZWVuW2lkXSA9IHRydWU7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBPYmplY3Qua2V5cyh0aGlzLmhlYWRpbmdzKS5mb3JFYWNoKChpZCkgPT4ge1xuICAgICAgaWYgKCFzZWVuW2lkXSkge1xuICAgICAgICB0aGlzLnJlbW92ZUhlYWRpbmcoaWQpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG4gIFxuICBjbGVhbnVwKCkge1xuICAgIHRoaXMucHJldmlld1NpemVyUmVmID0gbnVsbDtcbiAgICB0aGlzLmNvZGVNaXJyb3JTaXplclJlZiA9IG51bGw7XG5cbiAgICBPYmplY3Qua2V5cyh0aGlzLmhlYWRpbmdzKS5mb3JFYWNoKChpZCkgPT4ge1xuICAgICAgdGhpcy5yZW1vdmVIZWFkaW5nKGlkKTtcbiAgICB9KTtcbiAgfVxufVxuIiwiaW1wb3J0IHsgUGx1Z2luIH0gZnJvbSBcIm9ic2lkaWFuXCI7XHJcbmltcG9ydCB7IEhlYWRpbmdzTWFuYWdlciB9IGZyb20gXCIuL0hlYWRpbmdzTWFuYWdlclwiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRW1iZWRkZWROb3RlVGl0bGVzUGx1Z2luIGV4dGVuZHMgUGx1Z2luIHtcclxuICBoZWFkaW5nc01hbmFnZXI6IEhlYWRpbmdzTWFuYWdlcjtcclxuXHJcbiAgb25sb2FkKCkge1xyXG4gICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuYWRkKFwiZW1iZWRkZWQtbm90ZS10aXRsZXNcIik7XHJcbiAgICB0aGlzLmhlYWRpbmdzTWFuYWdlciA9IG5ldyBIZWFkaW5nc01hbmFnZXIoKTtcclxuXHJcbiAgICB0aGlzLnJlZ2lzdGVyRXZlbnQoXHJcbiAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS5vbihcImxheW91dC1jaGFuZ2VcIiwgKCkgPT4ge1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5oZWFkaW5nc01hbmFnZXIuY3JlYXRlSGVhZGluZ3ModGhpcy5hcHApO1xyXG4gICAgICAgIH0sIDApO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuXHJcbiAgICAvLyBMaXN0ZW4gZm9yIENTUyBjaGFuZ2VzIHNvIHdlIGNhbiByZWNhbGN1bGF0ZSBoZWFkaW5nIHN0eWxlc1xyXG4gICAgdGhpcy5yZWdpc3RlckV2ZW50KFxyXG4gICAgICB0aGlzLmFwcC53b3Jrc3BhY2Uub24oXCJjc3MtY2hhbmdlXCIsICgpID0+IHtcclxuICAgICAgICB0aGlzLmhlYWRpbmdzTWFuYWdlci5jbGVhbnVwKCk7XHJcblxyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5oZWFkaW5nc01hbmFnZXIuY3JlYXRlSGVhZGluZ3ModGhpcy5hcHApO1xyXG4gICAgICAgIH0sIDApO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuXHJcbiAgICB0aGlzLmFwcC53b3Jrc3BhY2UubGF5b3V0UmVhZHlcclxuICAgICAgPyB0aGlzLmFwcC53b3Jrc3BhY2UudHJpZ2dlcihcImxheW91dC1jaGFuZ2VcIilcclxuICAgICAgOiB0aGlzLmFwcC53b3Jrc3BhY2Uub25MYXlvdXRSZWFkeSgoKSA9PiB7XHJcbiAgICAgICAgICAvLyBUcmlnZ2VyIGxheW91dC1jaGFuZ2UgdG8gZW5zdXJlIGhlYWRpbmdzIGFyZSBjcmVhdGVkIHdoZW4gdGhlIGFwcCBsb2Fkc1xyXG4gICAgICAgICAgdGhpcy5hcHAud29ya3NwYWNlLnRyaWdnZXIoXCJsYXlvdXQtY2hhbmdlXCIpO1xyXG4gICAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgb251bmxvYWQoKSB7XHJcbiAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5yZW1vdmUoXCJlbWJlZGRlZC1ub3RlLXRpdGxlc1wiKTtcclxuICAgIHRoaXMuaGVhZGluZ3NNYW5hZ2VyLmNsZWFudXAoKTtcclxuICB9XHJcbn1cclxuIl0sIm5hbWVzIjpbImRlYm91bmNlIiwiUGx1Z2luIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQSxNQUFNLFVBQVUsR0FBRyxTQUFTLENBQUM7QUFDN0IsTUFBTSxLQUFLLEdBQUcsVUFBVSxDQUFDO0FBQ3pCLE1BQU0sUUFBUSxHQUFHLFdBQVcsQ0FBQztBQUM3QixNQUFNLE9BQU8sR0FBRyxhQUFhLENBQUM7QUFDOUIsTUFBTSxpQkFBaUIsR0FBRywyQkFBMkIsQ0FBQztBQUN0RCxNQUFNLGtCQUFrQixHQUFH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
